<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">Logs</h2>
  <div class="overflow-x-auto">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      @for (stat of stats(); track stat.label) {
        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center">
            <div
              class="h-12 w-12 flex items-center justify-center"
              [ngClass]="[stat.bgColor, 'rounded-sm']"
            >
              <span class="text-xl" [ngClass]="stat.iconColor">{{ stat.icon }}</span>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">{{ stat.label }}</p>
              <p class="text-2xl font-semibold text-gray-900">{{ stat.value }}</p>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- <div class="bg-gray-100 dark:bg-gray-900 p-4 rounded-md shadow-sm font-mono text-sm space-y-3"> -->
    <div class="space-y-4">
      @for (log of logs(); track log.id; let i = $index) {
        <div class="bg-white dark:bg-gray-800-gray-200 dark:border-gray-700 rounded-md shadow-sm">
          <!-- Cabeçalho -->
          <div class="flex flex-wrap justify-between items-start px-4 pt-4 pb-2">
            <div class="flex items-center space-x-3">
              <span
                class="px-2 py-0.5 text-xs font-semibold rounded"
                [ngClass]="{
                  'bg-blue-100 text-blue-800': log.statusLabel === 'INFO',
                  'bg-green-100 text-green-800': log.statusLabel === 'SUCESSO',
                  'bg-red-100 text-red-700': log.statusLabel === 'ERRO',
                }"
              >
                {{ log.statusLabel }}
              </span>
              <span class="text-gray-800 dark:text-gray-200 font-medium text-sm">{{
                log.action
              }}</span>
            </div>
            <div class="text-xs text-gray-400 mt-1 sm:mt-0">
              {{ log.timestamp | date: 'short' }}
            </div>
          </div>

          <!-- Infos visíveis -->
          <div
            class="px-4 pb-2 text-xs text-gray-600 dark:text-gray-300 grid sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-1"
          >
            <div><span class="font-semibold">ID:</span> {{ log.reportId }}</div>
            <div><span class="font-semibold">Criado por:</span> {{ log.created_by }}</div>
            <div>
              <span class="font-semibold">Duração:</span>
              {{ log.details.duration_seconds.toFixed(2) }}s
            </div>
            <div>
              <span class="font-semibold">Falhas:</span>
              <span
                [ngClass]="{
                  'text-red-600 font-bold': log.details.metrics.failed > 0,
                  'text-green-600 font-bold': log.details.metrics.failed === 0,
                }"
              >
                {{ log.details.metrics.failed }}
              </span>
            </div>
          </div>

          <!-- Botão toggle -->
          <div class="px-4 pb-3">
            <button
              type="button"
              class="text-blue-600 hover:underline text-xs font-medium flex items-center space-x-1"
              (click)="toggleLog(i)"
            >
              <span>{{ log.expanded ? 'Ocultar detalhes' : 'Ver detalhes' }}</span>
              <svg
                [class.rotate-180]="log.expanded"
                class="w-4 h-4 transform transition-transform"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            </button>
          </div>

          <!-- Accordion -->
          @if (log.expanded) {
            <div class="px-4 pb-4">
              <div
                class="bg-gray-50 dark:bg-gray-900-gray-200 dark:border-gray-700 rounded p-3 text-gray-800 dark:text-gray-200 text-sm whitespace-pre-wrap leading-relaxed"
              >
                {{ log.details.summary }}
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>
